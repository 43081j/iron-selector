<!--
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!--
`core-selector` is an element which can be used to manage a list of elements
that can be selected.  Tapping on the item will make the item selected.  The `selected` indicates
which item is being selected.  The default is to use the index of the item.

Example:

    <core-selector selected="0">
      <div>Item 1</div>
      <div>Item 2</div>
      <div>Item 3</div>
    </core-selector>

If you want to use the attribute value of an element for `selected` instead of the index,
set `attrForSelected` to the name of the attribute.  For example, if you want to select item by
`name`, set `attrForSelected` to `name`.

Example:

    <core-selector attrForSelected="name" selected="foo">
      <div name="foo">Foo</div>
      <div name="bar">Bar</div>
      <div name="zot">Zot</div>
    </core-selector>

`core-selector` is not styled. Use the `core-selected` CSS class to style the selected element.

Example:

    <style>
      .core-selected {
        background: #eee;
      }
    </style>

    ...

    <core-selector selected="0">
      <div>Item 1</div>
      <div>Item 2</div>
      <div>Item 3</div>
    </core-selector>

@group Polymer Core Elements
@element core-selector
@homepage github.io
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="core-selectable.html">

<script>

  Polymer({

    is: 'core-selector',

    mixins: [
      'core-selectable'
    ],

    published: {

      attrForSelected: String,

      selected: {
        type: String,
        notify: true
      },

      item: {
        type: Object,
        readOnly: true,
        notify: true
      },

      target: Object,

      activateEvent: String

    },

    bind: {
      selected: 'selectedChanged',
      target: 'targetChanged',
      activateEvent: 'activateEventChanged'
    },

    configure: function() {
      this._activateListener = this.activateHandler.bind(this);
      return {
        target: this,
        activateEvent: 'click'
      }
    },

    detached: function() {
      this.removeListener(this.target, this.activateEvent);
    },

    addListener: function(target, eventName) {
      if (target && eventName) {
        target.addEventListener(eventName, this._activateListener);
      }
    },

    removeListener: function(target, eventName) {
      if (target && eventName) {
        target.removeEventListener(eventName, this._activateListener);
      }
    },

    targetChanged: function(target, old) {
      this.removeListener(old, this.activateEvent);
      this.addListener(target, this.activateEvent);
      this.observeItems();
    },

    activateEventChanged: function(eventName, old) {
      this.removeListener(this.target, old);
      this.addListener(this.target, eventName);
    },

    selectedChanged: function(selected, old) {
      this._selectedChanged(selected, old);
    },

    activateHandler: function(e) {
      var t = e.target;
      var items = this.items;
      while (t && t != this.target) {
        var i = items.indexOf(t);
        if (i >= 0) {
          var value = this.indexToValue(i);
          if (!this.fire('core-activate', {selected: value}).defaultPrevented) {
            this.selected = value;
          }
          return;
        }
        t = t.parentNode;
      }
    }

  });

</script>
